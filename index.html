<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internship Portfolio</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css"> <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        /* CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤ Index */
        body { font-family: 'Kanit', sans-serif; background-color: #f8f9fa; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        
        .profile-card {
            background: white; padding: 20px; border-radius: 12px;
            text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #06C755; margin-bottom: 10px; }
        
        .form-card {
            background: white; padding: 20px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        input, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background-color: #06C755; color: white; border: none; font-weight: bold; cursor: pointer; }
        button:hover { background-color: #05a546; }

        /* --- ‚ú® ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞ Feedback --- */
        .work-card {
            background: white; padding: 15px; border-radius: 10px;
            margin-bottom: 15px; border-left: 5px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .status-badge {
            display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; color: white;
        }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á Feedback ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà */
        .feedback-box {
            background-color: #e7f3ff; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            border-left: 4px solid #1877f2; /* ‡∏Ç‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
            padding: 10px; margin-top: 10px; border-radius: 4px;
            font-size: 0.9em; color: #333;
        }
        .feedback-title { font-weight: bold; color: #1877f2; margin-bottom: 2px; }
        
        /* Utility */
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <div id="loading" style="text-align:center; margin-top:50px;">
            <p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <div id="main-app" class="hidden">
            
            <div class="profile-card">
                <img id="u-img" class="profile-img" src="">
                <h3 id="u-name">Name</h3>
                <p style="color:#666;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°: <span id="u-score" style="color:#06C755; font-weight:bold; font-size:1.2em;">0</span> ‡πÅ‡∏ï‡πâ‡∏°</p>
            </div>

            <div class="form-card">
                <h4>üì§ ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h4>
                <input type="text" id="w-title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô EP.1 ‡∏™‡∏£‡∏∏‡∏õ...)">
                <input type="url" id="w-link" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô (Google Drive/Canva)">
                <button onclick="submitWork()">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
            </div>

            <h4 style="margin-left:5px;">üìÇ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</h4>
            <div id="work-list">
                </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        // üîí CONFIG: ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á User (‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ö Admin ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ)
        const USER_LIFF_ID = "2008959998-yjcNpaGt"; 

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
        let userProfile = null;
        let userId = "";

        async function main() {
            try {
                await liff.init({ liffId: USER_LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
                    userProfile = await liff.getProfile();
                    userId = userProfile.userId;
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    
                    document.getElementById('u-img').src = userProfile.pictureUrl;
                    document.getElementById('u-name').innerText = userProfile.displayName;

                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡πÉ‡∏ô Database (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
                    checkAndCreateUser();
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡πÜ
                    loadMyWorks();
                }
            } catch (err) {
                alert("LIFF Error: " + err.message);
            }
        }
        main();

        // --- 1. ‡πÄ‡∏ä‡πá‡∏Ñ User / ‡∏î‡∏∂‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ---
        function checkAndCreateUser() {
            const userRef = db.collection("users").doc(userId);
            userRef.onSnapshot((doc) => {
                if (doc.exists) {
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß -> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    document.getElementById('u-score').innerText = doc.data().score || 0;
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    userRef.set({
                        displayName: userProfile.displayName,
                        pictureUrl: userProfile.pictureUrl,
                        score: 0,
                        joinedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            });
        }

        // --- 2. ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô ---
        async function submitWork() {
            const title = document.getElementById('w-title').value;
            const link = document.getElementById('w-link').value;

            if(!title || !link) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"); return; }

            try {
                await db.collection("works").add({
                    userId: userId, // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô
                    displayName: userProfile.displayName,
                    pictureUrl: userProfile.pictureUrl,
                    title: title,
                    link: link,
                    status: "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à",
                    feedback: "", // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! üéâ");
                document.getElementById('w-title').value = "";
                document.getElementById('w-link').value = "";
            } catch(e) {
                alert("Error: " + e.message);
            }
        }

        // --- 3. ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô + ‡πÅ‡∏™‡∏î‡∏á Feedback (Highlight) ---
        function loadMyWorks() {
            db.collection("works")
              .where("userId", "==", userId)
              .orderBy("timestamp", "desc")
              .onSnapshot((snapshot) => {
                const list = document.getElementById('work-list');
                list.innerHTML = "";

                if(snapshot.empty) {
                    list.innerHTML = "<p style='text-align:center; color:#999;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</p>";
                    return;
                }

                snapshot.forEach(doc => {
                    const w = doc.data();
                    
                    // ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    let badgeColor = "#ffc107"; // ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)
                    if(w.status === "‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß") badgeColor = "#28a745"; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                    if(w.status === "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç") badgeColor = "#dc3545"; // ‡πÅ‡∏î‡∏á
                    
                    // ‚ú® ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á Feedback (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    let feedbackHtml = "";
                    if (w.feedback && w.feedback.trim() !== "") {
                        feedbackHtml = `
                            <div class="feedback-box">
                                <div class="feedback-title">üí¨ Admin ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå:</div>
                                "${w.feedback}"
                            </div>
                        `;
                    }

                    list.innerHTML += `
                        <div class="work-card" style="border-left-color: ${badgeColor};">
                            <div style="display:flex; justify-content:space-between; align-items:start;">
                                <div>
                                    <h4 style="margin:0 0 5px 0;">${w.title}</h4>
                                    <span class="status-badge" style="background:${badgeColor}">${w.status}</span>
                                    <span style="font-size:0.8em; color:#999; margin-left:5px;">
                                        ${w.timestamp ? w.timestamp.toDate().toLocaleDateString('th-TH') : ''}
                                    </span>
                                </div>
                                <a href="${w.link}" target="_blank" style="font-size:1.5em; text-decoration:none;">üîó</a>
                            </div>
                            
                            ${feedbackHtml}
                            
                        </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>
